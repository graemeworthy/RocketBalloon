<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <style>
    h1 {
     position: absolute;
     top: 130px;
    }
    canvas{
     border: solid 1px black;
    }
  </style>
  <script>
    
    function Ball(){
      var self = this;
      self.x      = 0;
      self.y      = 0;
      self.vx     = 0;
      self.vy     = 0;
      self.radius = 40;
      self.arena;
      self.flame = false;
      self.thrust = false;
      self.color  = '#ccc'
      
      self.move = function(){
       var x = self.x
       var y = self.y
       var vy = self.vy
       var vx = self.vx
       var x0 = self.arena.x0
       var x1 = self.arena.x1
       var y0 = self.arena.y0
       var y1 = self.arena.y1
       if ((self.vy < 0) && (self.thrust))  {
        self.flame = true;
      } else {
      self.flame = false;
      self.thrust = false;
      }
       if (y < y1 -1) {vy += 1}
        vy  = vy * friction;
        vx =  vx * friction;
        if (y >= y1) {
          if (Math.abs(vy) <1) { vy = 0}
          print( y + " : " + vy)
          vy = (vy * 0.9 * -1)
        }
        y = y1 - Math.abs(y1 - y)
        y = y + vy;
                         
 
        if ((x <= x0) || ( x > x1)) { vx = vx * -1}
        if (x < x0) { x = x0}
        if (x > x1) {x = x1}
        x = x + vx

        self.x = x
        self.y = y
        self.vx = vx
        self.vy = vy
      }
      self.draw = function(){
        //flame
        if (self.flame) {
        canvas.beginPath(); 
        canvas.moveTo(self.x - self.radius/3, self.y + self.radius)
        canvas.lineTo(self.x, self.y + self.radius * 2)
        canvas.lineTo(self.x + self.radius/3, self.y + self.radius)   
        canvas.closePath();
        canvas.strokeStyle = "red";
        canvas.stroke();
        canvas.fillStyle = "orange";
        canvas.fill();
        }
 
        // ball
        canvas.beginPath(); 
        canvas.arc(self.x, self.y, self.radius, 0, Math.PI*2, false);
        canvas.closePath();
        canvas.strokeStyle = "#000";
        canvas.stroke();
        canvas.fillStyle = self.color;
        canvas.fill();
        
    
 }
    }
    function Arena(element){
      var self = this;
      self.h = 500;
      self.w = 1300; 
      self.padding = 30;
      self.x0 = 0 + self.padding;
      self.x1 = self.w - self.padding;
      self.y0 = 0 + self.padding;
      self.y1 = self.h - self.padding;

      self.element = element;
      self.canvas
      
      self.init = function(){
        if (!element) {return}
        // attaches as a child of element
        var canvas_element = document.createElement('canvas')
        var canvas = canvas_element.getContext("2d");
        var anchor = document.getElementById(element)
        console.log(anchor)
        anchor.appendChild(canvas_element)
        canvas_element.setAttribute('width', self.w);
        canvas_element.setAttribute('height',self.h);
         
        self.canvas = canvas;
      }
      self.drawGrid = function(){
         for (var x = 0.5; x < self.w; x += 10) {
            canvas.moveTo(x, 0);
            canvas.lineTo(x, self.h);
          }
          for (var y = 0.5; y < self.h; y += 10) {
            canvas.moveTo(0, y);
            canvas.lineTo(self.w, y);
          }
          canvas.strokeStyle = "#eee";
          canvas.stroke();
        }
       self.init();
    }
    

    function initCanvas(){
      ball = new Ball();
      ball2 = new Ball();
      arena = new Arena('playground');
      canvas = arena.canvas;
      ball.arena = arena;
      ball2.arena = arena;
      ball.color = "#cc0"
      ball2.color = "#0cc"
      ball.y = 100;
      ball.x = 200;
      balls.push(ball)
      balls.push(ball2)
      playground = document.getElementById("playground");
      console.log(ball.x)
      setInterval(step, 100);
        draw();
    }

    setTimeout(initCanvas, 200);
   document.onkeyup = keystrokes;
    var playground;
    var canvas;
    var arena;
    var balls = [];
    var radius = 5;
    var friction = 90/100
   function step(){
        draw();
 
     for (i=0; i < balls.length; i++ ){
        var ball = balls[i];
        ball.move();
        ball.draw();
      }
   }

    
    function draw(){
      canvas.clearRect(0, 0, arena.w, arena.h)
      canvas.clearRect(0, 0, arena.w, arena.h)
      arena.drawGrid();
   }
    function print(text){
       var printspace = document.getElementById("rogger");
       printspace.innerHTML = text;
    }
    function keystrokes(){
      var keyId = event.keyCode;
      switch(keyId){
        case 37:
         print('left ' + ball.vx);
         ball.vx = ball.vx - 20;
         break;
        case 38:
         print('up');
         ball.vy = ball.vy - 20;
         ball.thrust = true;
          break;
        case 39:
        print('right');
        ball.vx = ball.vx + 20;
        break;
        case 40:
        print('down');
        ball.vy = ball.vy + 20;
        break;
 
      }
   }
   
  </script>  
</head>
<body>
  <h1>RocketBalloons</h1>
  <div id="playground" width="500px" height="200px"></div>
  <div id="rogger"></div>
</body>  
</html>

